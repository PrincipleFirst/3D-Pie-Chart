<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Pie Chart 展示页面</title>

  <!-- 引入库文件 -->
  <link rel="stylesheet" href="./3d-pie-chart.css">
  <script src="./3d-pie-chart-react.umd.js"></script>

  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          padding: 20px;
      }

      .header {
          text-align: center;
          color: white;
          margin-bottom: 40px;
      }

      .header h1 {
          font-size: 3rem;
          margin-bottom: 10px;
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
          font-size: 1.2rem;
          opacity: 0.9;
      }

      .showcase-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
          gap: 30px;
          max-width: 1400px;
          margin: 0 auto;
      }

      .chart-card {
          background: white;
          border-radius: 15px;
          padding: 25px;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
          transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .chart-card:hover {
          transform: translateY(-5px);
          box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
      }

      .chart-title {
          font-size: 1.5rem;
          font-weight: bold;
          color: #333;
          margin-bottom: 15px;
          text-align: center;
      }

      .chart-description {
          color: #666;
          margin-bottom: 20px;
          text-align: center;
          line-height: 1.5;
      }

      .chart-container {
          width: 100%;
          height: 650px;
          border-radius: 10px;
          overflow: hidden;
          border: 2px solid #f0f0f0;
      }

      .controls {
          margin-top: 20px;
          display: flex;
          gap: 10px;
          justify-content: center;
          flex-wrap: wrap;
      }

      .btn {
          background: linear-gradient(45deg, #667eea, #764ba2);
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 25px;
          cursor: pointer;
          font-size: 14px;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
      }

      .btn:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
      }

      .btn.secondary {
          background: linear-gradient(45deg, #f093fb, #f5576c);
      }

      .btn.secondary:hover {
          box-shadow: 0 6px 20px rgba(240, 147, 251, 0.4);
      }

      .btn.success {
          background: linear-gradient(45deg, #4facfe, #00f2fe);
      }

      .btn.success:hover {
          box-shadow: 0 6px 20px rgba(79, 172, 254, 0.4);
      }

      .status-bar {
          background: #f8f9fa;
          padding: 15px;
          border-radius: 10px;
          margin-top: 20px;
          border-left: 4px solid #667eea;
      }

      .status-text {
          color: #333;
          font-weight: 500;
      }

      .footer {
          text-align: center;
          margin-top: 50px;
          color: white;
          opacity: 0.8;
      }

      @media (max-width: 768px) {
          .showcase-grid {
              grid-template-columns: 1fr;
              gap: 20px;
          }

          .header h1 {
              font-size: 2rem;
          }

          .chart-container {
              height: 600px;
          }
      }

      /* 富文本标签动画 */
      @keyframes glow {
          from {
              text-shadow: 0 0 10px currentColor;
          }
          to {
              text-shadow: 0 0 20px currentColor, 0 0 30px currentColor;
          }
      }

      /* 脉冲动画 */
      @keyframes pulse {
          0% {
              transform: scale(1);
          }
          50% {
              transform: scale(1.05);
          }
          100% {
              transform: scale(1);
          }
      }

  </style>
</head>
<body>
<div class="header">
  <h1>🎯 3D Pie Chart 展示</h1>
  <p>基于 React 的 3D 饼图库，支持富文本标签、交互控制、主题切换等功能</p>
</div>

<div class="showcase-grid">

  <!-- 复杂富文本标签 -->
  <div class="chart-card">
    <div class="chart-title">✨ 富文本环形图</div>
    <div class="chart-description">宽环形图，突出环形结构，适合装饰性展示</div>
    <div class="chart-container" id="chart3"></div>
    <div class="controls">
      <button class="btn" onclick="updateChart3()">切换标签</button>
      <button class="btn secondary" onclick="resetCamera('chart3')">重置相机</button>
      <button class="btn secondary" onclick="toggleAutoRotate('chart3')">切换旋转</button>
    </div>
    <div class="status-bar">
      <div class="status-text">状态：✅ 图表已加载</div>
    </div>
  </div>
</div>

<div class="footer">
  <p>基于 React + Three.js 构建 | 支持富文本标签、3D效果、交互控制</p>
</div>

<script>
  let charts = {}
  let autoUpdateInterval = null

  // 页面加载完成后初始化所有图表
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
      initAllCharts()
    }, 200)
  })

  // 初始化所有图表
  function initAllCharts() {
    try {
      // 预先为所有容器绑定事件监听，避免在图表就绪事件触发前错过监听
      ['chart3'].forEach((chartId) => {
        const container = document.getElementById(chartId)
        if (!container) return
        container.addEventListener('sliceClick', (event) => {
          console.log(`${chartId} 扇区点击:`, event.detail)
        })
        container.addEventListener('chartReady', (event) => {
          console.log(`${chartId} 图表就绪:`, event.detail)
          if (event.detail && event.detail.cameraControls) {
            if (!charts[chartId]) charts[chartId] = {}
            charts[chartId].cameraControls = event.detail.cameraControls
            console.log(`${chartId} 相机控制已启用`)
          }
        })
      })

      // 图表3：复杂富文本标签（展示灵活的样式配置）
      charts.chart3 = init3DPieChart('chart3', {
        data: [
          {
            value: 1.5,
            color: '#ff6b6b',
            label: '<div style=\'text-align: center; transform: rotate(-2deg);\'><div style=\'color: #ff6b6b; font-size: 1.2em; font-weight: bold; text-shadow: 0 0 10px #ff6b6b; animation: glow 2s ease-in-out infinite alternate; margin-bottom: 12px;\'>🔥 产品A 热销版 🔥</div><div style=\'color: #4ecdc4; font-size: 0.9em; margin: 2px 0; margin-bottom: 22px;\'><span style=\'background: linear-gradient(45deg, #4ecdc4, #44a08d); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\'>✨ 全新升级 ✨</span></div><div style=\'color: #feca57; font-size: 0.8em; font-style: italic;\'><span style=\'border: 1px solid #feca57; padding: 1px 4px; border-radius: 3px; background: rgba(254, 202, 87, 0.1);\'>限时特价 8.8折</span></div></div>',
            explode: false,
            height: 0.5,
            offset: 0,
            labelLineStyle: {
              labelOffset: 120,
              labelLineColor: '#ff0000',
              labelLineWidth: 1,
            },
            labelClassName: 'custom-label-style',
            labelContainerStyle: {
              background: 'rgba(0, 0, 0, 0.8)',
              padding: '12px',
              borderRadius: '8px',
              border: '2px solid rgba(255, 107, 107, 0.6)',
              minWidth: '250px',
              boxShadow: '0 4px 20px rgba(255, 107, 107, 0.3)',
              backdropFilter: 'blur(10px)',
              transition: 'all 0.3s ease',
            },
          },
          {
            value: 0.85,
            color: '#45b7d1',
            label: '<div style=\'text-align: center;\'><div style=\'color: #45b7d1; font-size: 1.1em; font-weight: bold; margin-bottom: 12px; animation: pulse 2s infinite;\'><span style=\'background: linear-gradient(90deg, #45b7d1, #96ceb4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\'>🚀 产品B 旗舰版</span></div><div style=\'color: #96ceb4; font-size: 0.9em; margin: 2px 0; margin-bottom: 22px;\'><span style=\'border-left: 3px solid #96ceb4; padding-left: 8px; background: rgba(150, 206, 180, 0.1);\'>💎 钻石品质保证</span></div><div style=\'color: #feca57; font-size: 0.8em;\'><span style=\'background: linear-gradient(45deg, #feca57, #ff9ff3); padding: 2px 6px; border-radius: 4px; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);\'>VIP 专属服务</span></div></div>',
            explode: false,
            height: 0.5,
            offset: 0,
            labelLineStyle: {
              labelOffset: 120,
              labelLineColor: '#0000ff',
              labelLineWidth: 1,
            },
            labelClassName: 'premium-label-style',
            labelContainerStyle: {
              background: 'linear-gradient(135deg, rgba(69, 183, 209, 0.1), rgba(150, 206, 180, 0.1))',
              padding: '10px',
              borderRadius: '6px',
              border: '1px solid rgba(69, 183, 209, 0.4)',
              minWidth: '220px',
              backdropFilter: 'blur(10px)',
              filter: 'hue-rotate(45deg)',
              cursor: 'pointer',
            },
          },
          {
            value: 0.6,
            color: '#ffd700',
            label: '<div style=\'text-align: center;\'><div style=\'color: #ffd700; font-size: 1.1em; font-weight: bold; text-shadow: 0 0 8px #ffd700; margin-bottom: 12px;\'><span style=\'background: radial-gradient(circle, #ffd700, #ffed4e); padding: 2px 8px; border-radius: 5px; color: #333;\'>⭐ 产品C 至尊版 ⭐</span></div><div style=\'color: #ff9ff3; font-size: 0.9em; margin: 2px 0; margin-bottom: 22px;\'><span style=\'border: 2px dashed #ff9ff3; padding: 1px 6px; border-radius: 3px; background: rgba(255, 159, 243, 0.1);\'>🎯 精准定位 智能推荐</span></div><div style=\'color: #54a0ff; font-size: 0.8em; font-style: italic;\'><span style=\'background: linear-gradient(135deg, #54a0ff, #5f27cd); color: white; padding: 1px 5px; border-radius: 3px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);\'>AI 驱动 未来科技</span></div></div>',
            explode: false,
            height: 0.5,
            offset: 0,
            labelLineStyle: {
              labelOffset: 160,
              labelLineColor: '#00ff00',
              labelLineWidth: 1,
            },
            labelClassName: 'luxury-label-style',
            labelContainerStyle: {
              background: 'radial-gradient(circle, rgba(255, 215, 0, 0.15), rgba(255, 237, 78, 0.1))',
              padding: '15px',
              borderRadius: '12px',
              border: '2px dashed rgba(255, 215, 0, 0.6)',
              minWidth: '280px',
              boxShadow: '0 6px 25px rgba(255, 215, 0, 0.2)',
              textShadow: '2px 2px 4px rgba(0,0,0,0.5)',
              letterSpacing: '1px',
              wordSpacing: '2px',
              lineHeight: '1.6',
            },
          },
          {
            value: 0.4,
            color: '#ff9ff3',
            label: '<div style=\'text-align: center;\'><div style=\'color: #ff9ff3; font-size: 1.1em; font-weight: bold; margin-bottom: 12px;\'><span style=\'background: linear-gradient(45deg, #ff9ff3, #f368e0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 15px #ff9ff3;\'>🎭 产品D 艺术版</span></div><div style=\'color: #54a0ff; font-size: 0.9em; margin: 2px 0;  margin-bottom: 22px;\'><span style=\'border: 2px solid #54a0ff; border-radius: 15px; padding: 2px 8px; background: linear-gradient(135deg, rgba(84, 160, 255, 0.2), rgba(95, 39, 205, 0.2));\'>🎨 创意无限 艺术无界</span></div><div style=\'color: #ff6b6b; font-size: 0.8em; font-style: italic;\'><span style=\'background: radial-gradient(circle, #ff6b6b, #ee5a24); color: white; padding: 1px 6px; border-radius: 4px; box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);\'>🔥 限时抢购 库存紧张</span></div></div>',
            explode: false,
            labelLineStyle: {
              labelOffset: 90,
            },
            height: 0.5,
            offset: 0,
          },
          {
            value: 0.3,
            color: '#00d2d3',
            label: '<div style=\'text-align: center;\'><div style=\'color: #00d2d3; font-size: 1.1em; font-weight: bold; margin-bottom: 12px;\'><span style=\'background: linear-gradient(90deg, #00d2d3, #54a0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 12px #00d2d3;\'>🌟 产品E 探索版</span></div><div style=\'color: #5f27cd; font-size: 0.9em; margin: 2px 0; margin-bottom: 22px;\'><span style=\'border-left: 4px solid #5f27cd; padding-left: 10px; background: linear-gradient(90deg, rgba(95, 39, 205, 0.1), rgba(84, 160, 255, 0.1));\'>🔮 神秘功能 即将揭晓</span></div><div style=\'color: #ff9ff3; font-size: 0.8em;\'><span style=\'background: linear-gradient(135deg, #ff9ff3, #f368e0); color: white; padding: 2px 8px; border-radius: 6px; box-shadow: 0 3px 10px rgba(255, 159, 243, 0.4); text-shadow: 1px 1px 2px rgba(0,0,0,0.3);\'>🚀 敬请期待 惊喜不断</span></div></div>',
            explode: false,
            labelLineStyle: {
              labelOffset: 90,
            },
            height: 0.5,
            offset: 0,
          },
        ],
        layout: {
          title: '富文本标签展示',
          innerRadius: 100,
          outerRadius: 160,
        },
        style: {
          backgroundColor: '#1a202c',
        },
        camera: {
          position: [4, 6, 1],
          fov: 50,
          minPolarAngle: 0.28,
          maxPolarAngle: Math.PI - 0.28,
          minDistance: 3,
          maxDistance: 15,
          enableDamping: true,
          dampingFactor: 0.1,
        },
      })

      // 添加事件监听
      Object.keys(charts).forEach(chartId => {
        const container = document.getElementById(chartId)

        container.addEventListener('sliceClick', (event) => {
          console.log(`${chartId} 扇区点击:`, event.detail)
        })

        container.addEventListener('chartReady', (event) => {
          console.log(`${chartId} 图表就绪:`, event.detail)

          // 将相机控制方法保存到图表对象中
          if (event.detail && event.detail.cameraControls) {
            charts[chartId].cameraControls = event.detail.cameraControls
            console.log(`${chartId} 相机控制已启用`)
          }
        })
      })

      console.log('所有图表初始化完成！')

    } catch (error) {
      console.error('图表初始化失败:', error)
    }
  }

  // 图表3：更新标签
  function updateChart3() {
    if (!charts.chart3) return

    const labels = [
      '<div style=\'text-align: center;\'><div style=\'color: #ff6b6b; font-size: 1.2em; font-weight: bold; text-shadow: 0 0 15px #ff6b6b; animation: glow 1.5s ease-in-out infinite alternate; margin-bottom: 12px;\'>🔥 热销版 🔥</div><div style=\'color: #4ecdc4; font-size: 0.9em; margin: 2px 0; margin-bottom: 22px;\'><span style=\'background: linear-gradient(45deg, #4ecdc4, #44a08d); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\'>✨ 全新升级 ✨</span></div><div style=\'color: #feca57; font-size: 0.8em; font-style: italic;\'><span style=\'border: 1px solid #feca57; padding: 1px 4px; border-radius: 3px; background: rgba(254, 202, 87, 0.1);\'>限时特价 8.8折</span></div></div>',
      '<div style=\'text-align: center;\'><div style=\'color: #45b7d1; font-size: 1.2em; font-weight: bold; text-shadow: 0 0 12px #45b7d1; margin-bottom: 12px;\'><span style=\'background: linear-gradient(90deg, #45b7d1, #96ceb4); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\'>🚀 旗舰版</span></div><div style=\'color: #96ceb4; font-size: 0.9em; margin: 2px 0; margin-bottom: 22px;\'><span style=\'border-left: 3px solid #96ceb4; padding-left: 8px; background: rgba(150, 206, 180, 0.1);\'>💎 钻石品质保证</span></div><div style=\'color: #feca57; font-size: 0.8em;\'><span style=\'background: linear-gradient(45deg, #feca57, #ff9ff3); padding: 2px 6px; border-radius: 4px; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);\'>VIP 专属服务</span></div></div>',
      '<div style=\'text-align: center;\'><div style=\'color: #ffd700; font-size: 1.2em; font-weight: bold; text-shadow: 0 0 10px #ffd700; margin-bottom: 12px;\'><span style=\'background: radial-gradient(circle, #ffd700, #ffed4e); padding: 2px 8px; border-radius: 5px; color: #333;\'>⭐ 至尊版 ⭐</span></div><div style=\'color: #ff9ff3; font-size: 0.9em; margin: 2px 0; margin-bottom: 22px;\'><span style=\'border: 2px dashed #ff9ff3; padding: 1px 6px; border-radius: 3px; background: rgba(255, 159, 243, 0.1);\'>🎯 精准定位 智能推荐</span></div><div style=\'color: #54a0ff; font-size: 0.8em; font-style: italic;\'><span style=\'background: linear-gradient(135deg, #54a0ff, #5f27cd); color: white; padding: 1px 5px; border-radius: 3px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);\'>AI 驱动 未来科技</span></div></div>',
      '<div style=\'text-align: center;\'><div style=\'color: #ff9ff3; font-size: 1.1em; font-weight: bold; text-shadow: 0 0 12px #ff9ff3; margin-bottom: 12px;\'><span style=\'background: linear-gradient(45deg, #ff9ff3, #f368e0); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\'>🎭 艺术版</span></div><div style=\'color: #54a0ff; font-size: 0.9em; margin: 2px 0; margin-bottom: 22px;\'><span style=\'border-left: 3px solid #54a0ff; border-radius: 15px; padding: 2px 8px; background: linear-gradient(135deg, rgba(84, 160, 255, 0.2), rgba(95, 39, 205, 0.2));\'>🎨 创意无限 艺术无界</span></div><div style=\'color: #ff6b6b; font-size: 0.8em; font-style: italic;\'><span style=\'background: radial-gradient(circle, #ff6b6b, #ee5a24); color: white; padding: 1px 6px; border-radius: 4px; box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);\'>🔥 限时抢购 库存紧张</span></div></div>',
      '<div style=\'text-align: center;\'><div style=\'color: #00d2d3; font-size: 1.1em; font-weight: bold; text-shadow: 0 0 10px #00d2d3; margin-bottom: 12px;\'><span style=\'background: linear-gradient(90deg, #00d2d3, #54a0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;\'>🌟 探索版</span></div><div style=\'color: #5f27cd; font-size: 0.9em; margin: 2px 0; margin-bottom: 22px;\'><span style=\'border-left: 4px solid #5f27cd; padding-left: 10px; background: linear-gradient(135deg, rgba(95, 39, 205, 0.1), rgba(84, 160, 255, 0.1));\'>🔮 神秘功能 即将揭晓</span></div><div style=\'color: #ff9ff3; font-size: 0.8em;\'><span style=\'background: linear-gradient(135deg, #ff9ff3, #f368e0); color: white; padding: 2px 8px; border-radius: 6px; box-shadow: 0 3px 10px rgba(255, 159, 243, 0.4); text-shadow: 1px 1px 2px rgba(0,0,0,0.3);\'>🚀 敬请期待 惊喜不断</span></div></div>',
    ]

    const newData = charts.chart3.options.data.map((item, index) => ({
      ...item,
      label: labels[index],
    }))

    charts.chart3.setData(newData)
    updateStatus('chart3', '✅ 标签样式已更新')
  }

  // 更新状态
  function updateStatus(chartId, message) {
    const statusBar = document.querySelector(`#${chartId}`).closest('.chart-card').querySelector('.status-text')
    statusBar.textContent = `状态：${message}`
  }

  // 重置相机到初始位置
  function resetCamera(chartId) {
    if (!charts[chartId]) {
      console.error(`图表 ${chartId} 未初始化`)
      return
    }

    try {
      if (charts[chartId].cameraControls) {
        charts[chartId].cameraControls.resetCamera()
        updateStatus(chartId, '✅ 相机已重置到初始位置')
      } else {
        updateStatus(chartId, '❌ 该图表不支持相机控制')
      }
    } catch (error) {
      console.error(`重置相机失败:`, error)
      updateStatus(chartId, `❌ 相机重置失败: ${error.message}`)
    }
  }

  // 切换自动旋转
  function toggleAutoRotate(chartId) {
    if (!charts[chartId]) {
      console.error(`图表 ${chartId} 未初始化`)
      return
    }

    try {
      if (charts[chartId].cameraControls) {
        const currentState = charts[chartId].cameraControls.getCameraState()
        const newAutoRotate = !currentState.autoRotate

        charts[chartId].cameraControls.setAutoRotate(newAutoRotate, 1.0)

        updateStatus(chartId, newAutoRotate ? '✅ 自动旋转已开启' : '⏹️ 自动旋转已停止')
      } else {
        updateStatus(chartId, '❌ 该图表不支持相机控制')
      }
    } catch (error) {
      console.error(`切换自动旋转失败:`, error)
      updateStatus(chartId, `❌ 切换自动旋转失败: ${error.message}`)
    }
  }

  // 页面卸载时清理
  window.addEventListener('beforeunload', function() {
    if (autoUpdateInterval) {
      clearInterval(autoUpdateInterval)
    }
  })
</script>
</body>
</html>
